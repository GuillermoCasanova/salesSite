angular.module('Sales', ['ngRoute', 'ngResource', 'ngSanitize', 'smoothScroll' ])
    .config(function() {

});

angular.module('Sales')
    .config(['$routeProvider',

        function($routeProvider) {

    $routeProvider
    .when('/', {
        redirectTo: '/home'
    })

    .when('/home', {
        templateUrl: "templates/home/index.html"
    })

}]);

    angular.module("Sales")
    .directive('ssAudioPlayer', 
        function() {

        return {

            replace: true,
            restrict: "E",
            scope: true,
            require: "^ssPageTheme",
            templateUrl: "templates/directives/ssAudioPlayer.tpl.html",
            controller: [
            '$scope',
            function($scope) {

                $scope.placeHolderText = "Play music below";
                $scope.loadingText = "Loading track..."; 

            }],
            link: function(scope, element, attrs, ssPageTheme) {

                //Initializes the current song text with the placeholder text
                //and sets notPlayed to true; 
                scope.currentSong = scope.placeHolderText;


                scope.changeTheme = function(pThemeName) {
                    //Uses parent directive's controller function to change theme
                    ssPageTheme.changeTheme(pThemeName);
                };


                //Inits Controls for Audio Player as Jquery Object
                $controls = element.find(".controls");


                //Inits Soundcloud player with array of URLS
                var scplayer = new SoundCloudPlayer([
                    "https://soundcloud.com/sales/ivy",
                    "https://soundcloud.com/sales/jamz",
                    "https://soundcloud.com/sales/big-sis",
                    "https://soundcloud.com/sales/sales-renee",
                    "https://soundcloud.com/sales/vow",
                    "https://soundcloud.com/sales/chinese-new-year",
                    "https://soundcloud.com/sales/getting-it-on",
                    "https://soundcloud.com/sales/toto",
                    "https://soundcloud.com/sales/toto-xxyyxx-remix/"

                    ],{
                      consumer_key: "7a6e6123d37c58d267bdfa4d526e554c"
                    , autoplay: false
                    , toggle_pause: true
                    , preload: false
                    , cache: true
                    , loop : true
                    , debug: false
                });

                //Tells player the user has yet to play anything
                var hasNotPlayed = true; 

                //Function for changing theme
                var changeTheme = function() {
                    scope.isPlaying = true; 
                    scope.currentSong = scope.loadingText;
                    scope.$apply(); 

                    scplayer.track_info(scplayer.track_index()).done(function(track){
                        scope.currentSong = track.title;
                        scope.changeTheme(track.permalink);
                        //Has the jquery object use the scope of this directive 
                        scope.$apply();
                        
                    });
                };

                //Inits controls of audio player selecting DOM elements
                $controls.on("click", 'button', function(e){
                    
                    e.preventDefault();
                    var $this = jQuery(this)
                    if( $this.hasClass('play') ){ 

                        scplayer.pause();
                    }
                    else if( $this.hasClass('pause') ) { 
                        if(hasNotPlayed === true) {
                            changeTheme(); 
                            hasNotPlayed = false; 

                            setTimeout(function() {
                                scplayer.pause(); 
                            }, 1000)

                            return; 
                        }
              
                        scplayer.pause(); 

                    }
                    else if( 
                        $this.hasClass('stop') ){ scplayer.stop(); 

                        /* Need to make pause button turn back to play button */
                        $controls.find('.play').addClass("pause");
                        $controls.find('.pause').removeClass("play");
                    }
                    else if( 
                        $this.hasClass('next') ){ scplayer.next(); 
                        if ( $controls.find('.pause') ){
                            $controls.find('.pause').addClass("play");
                            $controls.find('.play').removeClass("pause");
                            $controls.find('.play').click();                            
                        }
                    }
                    else if( 
                        $this.hasClass('prev') ){ scplayer.prev(); 
                        if ( $controls.find('.pause') ){
                            $controls.find('.pause').addClass("play");
                            $controls.find('.play').removeClass("pause");
                            $controls.find('.play').click();                            
                        }
                    }
                });

                
                scplayer.on("scplayer.pause", function(e, is_paused){

                    if(is_paused === true){
                        $controls.find('.play').addClass("pause");
                        $controls.find('.pause').removeClass("play");
                    }else{
                        $controls.find('.pause').addClass("play");
                        $controls.find('.play').removeClass("pause");
                    }

                });                
                
                //Changes currentSong and theme on the changing_track event
                scplayer.on('scplayer.changing_track', function(e, index) {

                    if(hasNotPlayed === true) {
                        return;
                    }

                    changeTheme(); 
                });

                
            }
        };

});

angular.module('Sales')
    .factory('Blog',
       function(
      ) {

        var posts = [
                    {
                        'title' : 'NORTH AMERICAN SPRING TOUR 2016',
                        'date': 'April 16th, 2015',
                        'thumbnail': 'https://s3.amazonaws.com/salessite/SALES_NORTH_AMERICAN_SPRING_2016.jpg',
                        'mainImage' : 'https://s3.amazonaws.com/salessite/SALES_NORTH_AMERICAN_SPRING_2016_header.jpg',
                        'id' : 'spring_2016_ivy',
                        'body' : '<p>I know it hasn\'t been so long since we last talked, but we wanted to get in touch and see how you are doing. Maybe you could use a fresh track?</p> <p>Here is our latest single, <a href="https://soundcloud.com/sales/ivy" target="_blank">"ivy",</a> hope it\'s something you can put your story to.  </p> <p>We\'ll be on tour, and sharing our album in April #420. Check the site for dates/tickets and come see us. We\'d love to meet you and maybe even hang-out (taco party in San Diego, bagel and schmear in Brooklyn, we want to see redwoods, and maybe we could go for a biscuit in Nashville?). Let us know. </p> <p>All the best, </p> <p>Lauren & Jordan <span class="fwb">SALES</span></p>'
                    },

                    {
                        'title' : 'WEST COAST SUMMER 2015',
                        'date': 'June 1st, 2015',
                        'thumbnail': 'https://s3.amazonaws.com/salessite/SALES_West_Coast_2015.jpg',
                        'mainImage' : 'https://s3.amazonaws.com/salessite/SALES_West_Coast_2015_header.png',
                        'id' : 'west',
                        'body' : 'We love ya\'ll so much, we can\'t stay away. We are pleased to announce the following west coast tour dates: <a href="http://on.fb.me/1QkZvb6" target="_blank">http://on.fb.me/1QkZvb6</a>'
                    },

                    {
                        "title": "SALES from 12 to 12",
                        "date": "May 14th, 2015",
                        'thumbnail': 'https://s3.amazonaws.com/salessite/SALES_from12_to_12.jpg',
                        'mainImage': 'https://s3.amazonaws.com/salessite/SALES_from12_to_12.jpg',
                        'id' : 'sales',
                        'body' : '<b>We are excited</b>  to share our first video series with you. This three-part video series is the brainchild of Josef Lorenzo (director) and was made possible by the work of Harryson Thevenin (audio) and Alana Questell (animation). Looking forward to getting to meet you this fall.  <p>Videos + tour dates below.<p><p> Love, <br>Lauren & Jordan <br><3 SALES <3</p> <p>P.S. There are three (3) videos in the series, <a href="https://www.youtube.com/playlist?list=PLLCdbcMe7pOxqSypUt40sbbqX9WX2h8DP" target="_blank">click here</a> for movie magic.</p>'
                    },
                    {
                        "title": "EUROPEAN TOUR 2015",
                        "date": "May 2nd, 2015",
                        'thumbnail': 'https://s3.amazonaws.com/salessite/SALES_EU_2015.jpg',
                        'mainImage' : 'https://s3.amazonaws.com/salessite/SALES_EU_2015_header.png',
                        'id' : 'european',
                        'body' : '<p>Hey Friends! It\'s been fun touring the U.S. and Canada, but we are really excited about our upcoming <b>2015 European Tour</b> this Fall. We will spend a whole month touring Europe and will hopefully get to meet you. Until that beautiful day when we cross the Atlantic Ocean into your arms, we will be spending the next few months in our home studio (bedroom) working on a full length album.</p><p>Event page & tickets here: <a href="http://on.fb.me/1Ixmkrq" target="_blank">http://on.fb.me/1Ixmkrq</a></p>'

                    }
                ];
    return {
            getPosts : function() {

                return posts; 
            }

    }

});

angular.module('Sales')
    .controller('blogController', [

        '$scope',
        '$location',

        function($scope,  $location){
        
             $scope.posts = [

                    {
                        'title' : 'WEST COAST SUMMER 2015',
                        'date': 'June 1st, 2015',
                        'thumbnail': 'https://scontent-atl1-1.xx.fbcdn.net/hphotos-xfa1/t31.0-8/10548057_826259747456624_3660037826613998656_o.jpg',
                        'body' : 'We Emoticono heart ya\'ll so much, we can\'t stay away. We are pleased to announce the following west coast tour dates: http://on.fb.me/<1QkZvb6></1QkZvb6>**The Echo show is ALL AGES / Soda Bar 21+**'
                    },

                    {
                        "title": "SALES from 12 to 12",
                        "date": "May 14th, 2015",
                        'thumbnail': 'https://s3.amazonaws.com/salessite/SALES_from12_to_12.jpg',
                        'body' : 'big movie voice* This fall, two best friends will make the journey of a lifetime across the Atlantic Ocean in search of more cuisine, more ears, and more friends. Europe this fall, yall! Tour poster by Alana Questell'
                    },
                    {
                        "title": "EUROPEAN TOUR 2015",
                        "date": "May 2nd, 2015",
                        'thumbnail': 'https://scontent-atl1-1.xx.fbcdn.net/hphotos-xpt1/t31.0-8/p526x296/11263107_816216705127595_9028048071337470597_o.jpg',
                    }
                ];


}]);
angular.module("Sales")
    .directive('ssBlogPostsCarousel', [
        function() {

        return {

            replace: true,
            restrict: "E",
            templateUrl: "templates/directives/ssBlogPostsCarousel.tpl.html",
            scope: {},
            link: function(scope, element, attrs) {

               $(document).foundation('reveal', 'reflow'); 

               $(document).on('close.fndtn.reveal', '[data-reveal]', function () {
                  setTimeout(function() {

                      scope.selectedPost = {};  
                      scope.$apply(); 
                  }, 1000);

               });

               scope.selectBlogPost = function(pPost) {
                   scope.selectedPost = pPost; 
                   angular.element("#modal").foundation('reveal', 'open');
                };


            },
            controller: [
            '$scope',
            'Blog',
            function($scope, Blog) {
                $scope.selectedPost  = {}; 
                $scope.posts = Blog.getPosts(); 
            }]


        };

    }]);

angular.module("Sales")
    .directive('ssPageFooter', function() {

        return {
            replace: true, 
            restrict: "E",
            scope: {}, 
            templateUrl: "templates/directives/ssPageFooter.tpl.html"

        };

});
angular.module("Sales")
    .directive('carouselSlick', [
        '$timeout',
        function($timeout) {

    return {

        scope: {},
        restrict: 'A',
        link: function(scope, element, attrs) {

            $timeout(function() {   

                 $(element).slick({
                    autoplay: attrs.autoplay,
                    arrows: true, 
                    dots: attrs.dots || false,
                    lazyLoad: attrs.lazyload || 'progressive', 
                    speed: attrs.speed || 2000, 
                    pauseOnHover: true,
                    infinite: true,
                    slidesToShow: attrs.slides,
                    responsive: [
                        {
                          breakpoint: 480,
                          settings: {
                            slidesToShow: 1,
                            slidesToScroll: 1
                          }
                        }

                    ]
                });

                //Removes all text from slick's next and previous buttons
                element.find('button').text("");

                //Inserts svg icons 
                element.find('.slick-next').append("<svg viewBox=\"0 0 144 144\" preserveAspectRatio=\"xMidYMid meet\"title=\"Play next track\"class=\"icon--controls\"><use xlink:href=\"images/icon--controls.svg#next-icon\"></use></svg>");
                
                element.find('.slick-prev').append("<svg viewBox=\"0 0 144 144\" preserveAspectRatio=\"xMidYMid meet\"title=\"Play next track\"class=\"icon--controls\"><use xlink:href=\"images/icon--controls.svg#prev-icon\"></use></svg>");

            }); 
            
        }

    };

}]);


angular.module("Sales")
    .directive('foundationInit', [
        '$timeout',
        function($timeout) {

        return {

             link: function(scope, element, attrs) {

                $timeout(function() {   

                      $(element).foundation(function() {

                        console.log("runnin foundation");

                      });

                      $(element).foundation('interchange', {

                          named_queries : {
                            
                            childBear : 'only screen and (min-width: 100px)',
                            teenBear :  'only screen and (min-width: 760px)',
                            mamaBear :  'only screen and (min-width: 900px)'
                          }

                      });

                      $(element).foundation('interchange', 'reflow');

                });

            }
        };

}]);

angular.module("Sales")
    .directive('ssImgProperties', function(){ 
   return {
     restrict: 'A',
     link: function(scope, element, attr) {

         element.on('load', function() {


            var w = $(this).width(),
                h = $(this).height();

            attr.$set('width', w);
            attr.$set('height', h); 


         });

     }
   };
});
angular.module("Sales")
    .directive('ssSpinner', [ 

        '$interval', 

        function($interval) {

            return {
                replace: true, 
                restrict: "E",
                templateUrl: "templates/directives/ssSpinner.tpl.html",
                scope: {},
                link: function(scope, element, attrs) {

                    var loadingText = [
                        'Loading',
                        'Loading.',
                        'Loading..',
                        'Loading...'
                    ];

                    var currentText = 0; 

                    scope.spinner = {
                        'text' : 'Loading'
                    };

                    scope.changeText = function(pSpinner, pText, index) {
                        pSpinner.text = pText[index]; 
                    };

                    $interval(function() {
                        if(currentText === loadingText.length) {
                            currentText = 0; 
                        }
                       scope.changeText(scope.spinner, loadingText, currentText); 
                       currentText++
                    }, 500);
                    
                }

            };
        
    }]);


angular.module("Sales")
    .directive('ssPageNav', function() {

        return {
            replace: true, 
            restrict: "E",
            scope: {}, 
            templateUrl: "templates/directives/ssPageNav.tpl.html"

        };

});
angular.module("Sales")
    .directive('ssSmallMainNav', function() {

        return {
            replace: true, 
            restrict: "E",
            templateUrl: "templates/directives/ssSmallMainNav.tpl.html",
            scope: {}, 
            link: function(scope, element, attrs) {
                scope.toggleNav = function() {
                    element.find('div.mainNav-menu').toggleClass('is-showing'); 
                };


            }

        };
        
    });

angular.module('Sales')
    .factory('Theme',
       function(
      ) {


        var themes = [
                {'name' : "getting-it-on"},
                {'name' : "ep"},
                {'name' : "sales-renee"},
                 {'name' : "vow"},
                 {'name' : 'toto'},
                 {'name' :'chinese-new-year'},
                 {'name' : 'toto-xxyyxx-remix'},
                 {'name' : 'big-sis'},
                 {'name' : 'jamz'},
                 {'name' : 'ivy'}

                ];
    return {
            getThemes : function() {

                return themes; 
            }

    }

});

angular.module("Sales")
    .directive('ssPageTheme', function() {

        return {
            restrict: "A",
            controller: [
            '$scope', 
            function($scope) {
                //Starter theme when user first lands on page
                $scope.defaultTheme = "ivy";
                //Themes are based off the song's permalinks 
                $scope.currentTheme = $scope.defaultTheme ;

               this.changeTheme = function(pTheme) {
                    $scope.currentTheme = pTheme; 

                };

                this.getCurrentTheme = function() {
                    return $scope.currentTheme;
                };

            }],
            controllerAs: 'ssPageTheme'

        };

});
angular.module('Sales')
    .directive('ssPageThemeBackgrounds', [
          '$timeout',
          'Theme',
        function(
          $timeout,
          Theme
        ) {

        return {

            restrict: 'E',
            scope: {}, 
            require: '^ssPageTheme',
            templateUrl : 'templates/directives/ssPageThemeBackgrounds.tpl.html',
            link: function(scope, element, attrs, ssPageTheme) {

                scope.component = attrs.component;

                scope.loaded = false; 

                scope.backgrounds = Theme.getThemes(); 

                scope.isActive = function(pBackground) {
                    return ssPageTheme.getCurrentTheme() === pBackground;
                }

            }

        }

}]);

angular.module('Sales')
    .factory('Shows', [
      '$http',
       function(
          $http
      ) {

    return {

        getShows : function() {

            return $http.jsonp('http://api.songkick.com/api/3.0/artists/7225704-sales/calendar.json?apikey=u3T0xdtx4AOTUzFw&jsoncallback=JSON_CALLBACK');
        }

    }

}]);

angular.module("Sales")
    .directive('ssShowsList', function() {

        return {
            replace: true, 
            restrict: "E",
            scope: {}, 
            templateUrl: "templates/directives/ssShowsList.tpl.html",
            controller: 'showsController',
            controllerAs: 'showsController',
            link: function(scope, element, attr) {
                scope.showsLimit = 20; 
                scope.viewingAllShows = false; 

                scope.showAllShows = function() {
                    scope.loading = true; 
                    scope.viewingAllShows = true; 

                    setTimeout(function() {
                        scope.showsLimit = scope.events.length; 
                        scope.loading = false; 
                    }, 800);
                }

                scope.isNotFestival = function(eventName) {

                 return eventName === "Concert";

                };

            }

        };
        
    });
angular.module('Sales')
    .controller('showsController', [
        'Shows', 
        '$scope',
        '$window',
        'smoothScroll',

        function(
        Shows, 
        $scope, 
        $window, 
        smoothScroll){

        $scope.search = {}; 
        $scope.events = {};
        $scope.loaded = false; 

        Shows.getShows()
            .success(function(pData) {
           $scope.loaded = true; 
           $scope.events = pData.resultsPage.results.event; 
        });

        $scope.navigateToTickets = function(ticketLink) {
            $window.open(ticketLink, "_blank");
        };

}]);
angular.module("Sales")
    .directive('ssVideoCarousel', 

        function() {

        return {

            replace: true,
            restrict: "E",
            templateUrl: "templates/directives/ssVideoCarousel.tpl.html"
        }
    });
